# Using the package with Plotly
## Bar charts

```{python}
#| eval: false
#| label: bar-charts-1

import pandas as pd
import plotly.express as px
import plotly.graph_objects as go

# AF Package
from afcharts.pio_template import pio


# Load the gapminder dataset from plotly.express
df = px.data.gapminder().query("year == 2007 & continent == 'Americas'")

top5 = df.nlargest(5, "pop")

fig = go.Figure()

fig.add_trace(
    go.Bar(
        x=top5["country"],
        y=top5["pop"],  # Repeat the category name for each x value
        name="test bar",  # Use the x value column name as the trace name
    )
)

# Update layout
fig.update_layout(
    meta=dict(alt="Bar chart showing sales of Product A (23 units), Product B (45 units), and Product C (56 units)."),
)

fig.show()

```

<div class="chart-title">The U.S.A. is the most populous country in the Americas</div>
<div class="chart-subtitle">Population of countries in the Americas (millions), 2007</div>

```{python}
#| ref-label: bar-charts-1
#| echo: false
#| eval: true
```

<div class="chart-source">Source: Gapminder</div>

This bar chart uses the afcharts theme, and shows the populations of the five most populous countries in the Americas. Each bar is dark blue and labelled by country underneath. All text is black in a sans serif font. Pale grey grid lines extend out from the y axis.

## Example of a line chart with duo palette

```{python}
#| eval: false
#| label: line-charts-2

import pandas as pd
import plotly.express as px
import plotly.graph_objects as go

# AF Package
from afcharts.pio_template import pio
from afcharts.assets.af_colours import duo

# Load the gapminder dataset from plotly.express
df = px.data.gapminder()

df = df[df["country"].isin(["United Kingdom", "China"])]

fig = go.Figure()

# Add a trace for each continent
for i, country in enumerate(df["country"].unique()):
    df_country = df[df["country"] == country]
    fig.add_trace(
        go.Scatter(
            x=df_country["year"],
            y=df_country["lifeExp"],
            mode="lines",
            name=country,
            text=df_country["country"],
            line=dict(color=duo[i % len(duo)])
        )
    )

# Update layout
fig.update_layout(
    xaxis=dict(
        title="Year",
    ),
    meta=dict(alt="Bar chart showing sales of Product A (23 units), Product B (45 units), and Product C (56 units)."),
)

fig.update_yaxes(range=[0, 82])

fig.show()

```

<div class="chart-title">Living Longer</div>
<div class="chart-subtitle">Life Expectancy in the United Kingdom and China 1952-2007</div>

```{python}
#| ref-label: line-charts-2
#| echo: false
#| eval: true
# #| fig-height: 5
```

<div class="chart-source">Source: Gapminder</div>


This line chart uses the afcharts theme and there are thin pale grey lines extending from the y axis. There are two thicker lines showing the life expectancy in the UK and China over time. The line colours are from the main Analysis Function palette - dark blue for China and orange for the UK, denoted by a legend at the bottom of the chart.

Legends should be avoided unless absolutely necessary, as these usually rely on using colour to match labels to data. More information can be found in the Analysis Function [charts guidance](https://analysisfunction.civilservice.gov.uk/policy-store/data-visualisation-charts/#section-11). It is best practice to label lines directly, and an example of this can be found in the [annotations](#annotations) section.

## Example of a scatterplot

```{python}
#| eval: false
#| label: scatterplot

import pandas as pd
import plotly.express as px
import plotly.graph_objects as go

# AF Package
from afcharts.pio_template import pio

# Load the gapminder dataset from plotly.express
df = px.data.gapminder()

df = df.query("year == 2007")

fig = go.Figure()

fig.add_trace(
    go.Scatter(
        x=df["gdpPercap"],
        y=df["lifeExp"],
        mode="markers",
    )
)

# Update layout
fig.update_layout(
    xaxis=dict(
        title="GDP (US$, inflation-adjusted)",
    ),
    yaxis=dict(
        title="Life\nExpectancy",
    )
)

fig.show()

```

<div class="chart-title">The relationship between GDP and Life Expectancy is complex</div>
<div class="chart-subtitle">GDP and Life Expectancy for all countries, 2007</div>

```{python}
#| ref-label: scatterplot
#| echo: false
#| eval: true
#| fig-height: 5

```

<div class="chart-source">Source: Gapminder</div>
